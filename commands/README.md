# 🔧 命令模板

编排模板，使 Claude Code 能够协调多代理工作流程，处理不同的开发任务。

## 概述

阅读[主工具包文档](../README.md)后，你会了解这些命令如何融入集成系统。每个命令都：

- **自动加载**适合其任务的相应文档层级
- **生成专业化代理**基于复杂性
- **集成 MCP 服务器**当需要外部专业知识时
- **维护文档**保持 AI 上下文的时效性

### 🚀 自动上下文注入

所有命令都通过 `subagent-context-injector.sh` 钩子受益于自动上下文注入：

- **核心文档自动加载**：每个命令和子代理自动接收 `@/docs/CLAUDE.md`、`@/docs/ai-context/project-structure.md` 和 `@/docs/ai-context/docs-overview.md`
- **无需手动上下文加载**：命令生成的子代理自动获得对基本项目文档的访问权限
- **一致的知识基础**：所有代理都从相同的基础理解开始

## 可用命令

### 📊 `/full-context`
**用途**：当你需要深度理解或计划执行代码变更时，进行全面的上下文收集和分析。

**何时使用**：
- 开始处理新功能或 bug
- 需要理解系统间如何互联
- 规划架构变更
- 任何需要在实施前进行彻底分析的任务

**工作原理**：根据请求复杂性，自适应地从直接分析扩展到多代理编排。代理读取文档、分析代码、映射依赖关系，并根据需要咨询 MCP 服务器。

### 🔍 `/code-review` 
**用途**：获得代码质量的多专家视角，专注于高影响发现而非细枝末节。

**何时使用**：
- 实施新功能后
- 合并重要变更前
- 当你需要安全、性能和架构洞察时
- 需要对代码质量有信心时

**工作原理**：生成专业化代理（安全、性能、架构）并行分析。每个代理专注于对生产代码重要的关键问题。

### 🧠 `/gemini-consult` *(需要 Gemini MCP 服务器)*
**用途**：与 Gemini 进行深度迭代对话，解决复杂问题和获得架构指导。

**何时使用**：
- 处理复杂的架构决策
- 需要实施方法的专家指导
- 调试跨多个文件的复杂问题
- 探索优化策略
- 当你需要解决困难问题的思维伙伴时

**工作原理**：与 Gemini 创建持久对话会话，自动附加项目上下文和 MCP-ASSISTANT-RULES.md。支持通过后续问题和实施反馈进行迭代改进。

**关键特性**：
- 未提供参数时的上下文感知问题检测
- 在整个问题生命周期中维护持久会话
- 自动附加基础项目文档
- 支持具有会话连续性的后续问题

### 📝 `/update-docs`
**用途**：保持文档与代码变更同步，确保 AI 上下文保持最新。

**何时使用**：
- 修改代码后
- 添加新功能后
- 项目结构发生变化时
- 任何重大实施后

**工作原理**：分析变更内容并更新所有层级中相应的 CLAUDE.md 文件。维护未来 AI 会话将依赖的上下文。

### 📄 `/create-docs`
**用途**：为缺乏 AI 优化文档的现有项目生成初始文档结构。

**何时使用**：
- 在现有项目中采用框架
- 从零开始创建文档
- 需要记录遗留代码
- 设置 3 层结构

**工作原理**：分析你的项目结构，在每个层级创建适当的 CLAUDE.md 文件，为 AI 辅助开发建立基础。

### ♻️ `/refactor`
**用途**：智能重构代码，同时保持功能性并更新所有依赖关系。

**何时使用**：
- 拆分大文件
- 改善代码组织
- 提取可重用组件
- 清理技术债务

**工作原理**：分析文件结构、映射依赖关系、识别逻辑拆分点，并处理整个代码库中的所有导入/导出更新。

### 🤝 `/handoff`
**用途**：在结束会话或对话变得过长时保存上下文。

**何时使用**：
- 结束工作会话
- 接近上下文限制
- 在主要任务间切换
- 用永久存储补充 `/compact`

**工作原理**：用会话成果、当前状态和下一步更新交接文档。确保在未来会话中平滑继续。

## 集成模式

### 典型工作流程
```bash
/full-context "implement user notifications"    # 理解
# ... 实施功能 ...
/code-review "review notification system"       # 验证  
/update-docs "document notification feature"    # 同步
/handoff "completed notification system"        # 保存
```

### 快速分析
```bash
/full-context "why is the API slow?"           # 调查
# ... 应用修复 ...
/update-docs "document performance fixes"       # 更新上下文
```

### 主要重构
```bash
/full-context "analyze authentication module"   # 理解当前状态
/refactor "@auth/large-auth-file.ts"          # 重构
/code-review "review refactored auth"          # 验证质量
/update-docs "document new auth structure"     # 保持文档最新
```

### 复杂问题解决
```bash
/gemini-consult "optimize real-time data pipeline" # 开始咨询
# ... 实施建议的方法 ...
/gemini-consult                                    # 跟进结果
/update-docs "document optimization approach"      # 捕获洞察
```

## 自定义

每个命令模板都可以调整：

- **调整代理策略** - 修改生成的代理数量和专业化方向
- **更改上下文加载** - 自定义加载哪些文档层级
- **调整 MCP 集成** - 调整何时咨询外部服务
- **修改输出格式** - 根据你的偏好定制结果

命令存储在 `.claude/commands/` 中，可以直接编辑。

## 关键原则

1. **命令协同工作** - 每个命令都建立在其他命令的输出基础上
2. **文档保持最新** - 命令维护自己的上下文
3. **复杂性自然扩展** - 简单任务保持简单，复杂任务获得精密分析
4. **上下文持续性** - 信息通过文档在会话间流动

---

*有关每个命令的详细实施，请查看此目录中的各个命令文件。*